---
title: "Fun with R:  Ecological data analysis in R"
author: "Vianney Denis"
date: "2020/09/15"
output:  
  "html_document":
   toc: true
   toc_depth: 3
   toc_float: true
   number_sections: false
   code_folding: show
    # ioslides_presentation 
---

# **Topic 1 - First steps** {.tabset}

## Introduction

### Syllabus

**Instructor:** Vianney DENIS [vianney.denis@gmail.com] - Functional Reef Ecology Laboratory, R406, 4F, Institute of Oceanography, National Taiwan University, Taiwan

**Students:** 11 crazy students with various background

**Aim of the Course:**The aim of this course is to get familiar with the programming language R while avoiding technical jargon. We will explore together the advantages of using R language for formatting reports,  preparing presentations, exploring and analyzing ecoloical, data creating and sharing project. We will start from scratch, i.e. downloading R and installing it on your computer. Along this class, you will be introduced to  RStudio GUI, Rmarkdown, and GitHub repositories that complete harmoniously the use of R. 

At the end of this class, student should: 

- not be afraid of coding anymore and see the advantages in doing it;
- be self-learner, able to explore and solve problem;
- analyze and valorize scientifically a dataset;
- know several statistical tools for the analysis of ecological data in particular;
- help and recommend on the use of R.

**Class Philosophy:** I am not a statistician and I am not a programmer, so I will speak with simple words. My aim is to teach you bases in R language for you to be explore its power by yourself. The aim is not to know everything, but to be able to learn anything.

**Evaluation & Final Assignment:** Each week students prepare an example of the application of the things learned in previous class . One student randomly chosen will introduce its example at the beginning the class (using Rmarkdown). 

For the final assignment, group (2-3 students) will pick up a research topic along the semester, and will prepare a report emphasis methodology and results (scientific forrmat). Introduction and discussion can be presented as bullet points. Report should be sent as a markdown file before the last class of the semester. Do not wait the last minute!

---

**Disclaimer:** Format of course largely inspired by documentation from Fukami T. & Coyle J. (Standford University). I am currently reshaping all documents to have more interaction with students during this course. 

### Tentative Schedule 

Schedule is highly susceptible to changes as I am updating content every week.

| Week | Day | Date     | Tentative Topic | Content|
|------|-----|----------|-----------------|--------|
| 1    | Tue | ---------| Introduction: First step | Introduction R, R Studio, Markdown, GitHub|
| 2 & 3 | Tue | ---------| Data manipulation, basic graphics and statistical functions | Manipulate dataset, basic operation, make and edit a plot|
| 4 & 5 | Tue | ---------| Data exploration | Summarize dataset, preliminary analyses |
| 6 | Tue | ---------| Ecological resemblance | Association coefficient, similarity matrix |
| 7 | Tue | ---------| Numerical classification | Cluster analysis |
| 8 & 9 | Tue | ---------| Unconstrained ordination | PCA, PCoA, nMDS |
| 10 & 11 | Tue | ---------| Constrained ordination | Redundancy and cannonical analysis |
| 12 & 13 | Tue | ---------| Generalized Linear Model | Linear regression, and GLMs |
| 14 | Tue | ---------| From traits to functions | --- |

### References & Readings

Borcard, D., Gillet, F. and Legendre, P. (2018) Numerical Ecology with R. Springer. DOI: [10.1007/978-3-319-71404-2](https://www.springer.com/gp/book/9783319714035)

Ramette, A. (2007) Multivariate analyses in microbial ecology. FEMS Microbiology Ecology, 62: 142-160. DOI: [10.1111/j.1574-6941.2007.00375.x](https://onlinelibrary.wiley.com/doi/full/10.1111/j.1574-6941.2007.00375.x)

Xie, Y., Allaire, J.J.,Grolemund, G. (2020) R Markdown: The Definitive Guide. Chapman & Hall/CRC. The online version of this book is free to read [here](https://bookdown.org/yihui/rmarkdown/). 

Zuur, A. F., Ieno E. N., Smith, G. M. (2007) Analysing Ecological Data. Springer.  DOI: [10.1007/978-0-387-45972-1](https://www.springer.com/gp/book/9780387459677)

Zuur, A. F. (2010) A protocol for data exploration to avoid common statistical problems. Methods in Ecology and Evolution, 1: 3-14. DOI: [10.1111/j.2041-210X.2009.00001.x](https://besjournals.onlinelibrary.wiley.com/doi/10.1111/j.2041-210X.2009.00001.x)

## R software

### What's R?

R is a popular free and open program for statistical computing (https://www.r-project.org/about.html). R is a widely-used program for statistical computing. R can be run from the command line or from a graphical user interface (GUI) that is automatically installed when you install R (if you open the R program installed on your computer, this is what will open up). 

R consists of a core (minimal installation + add on packages (from the Comprehensive R Archive Network, Bioconductor, or others). The core's capabilities is expanded by using the add-on packages.

### Installation

#### Windows

If you don't have R installed on your computer:

- Download R from the [CRAN website](https://cran.r-project.org/bin/windows/base/release.htm).
- Run the `.exe` file that was just downloaded.
- Once it’s installed, open R to make sure it works and you don’t get any error messages.

If you already have R already install:

To check the version of R you are using, start R: the version of R you are running is the first thing that appears on the terminal. Alternatively, Type `sessionInfo()` in the R console, which will  display which version of R you are running. Go on the [CRAN website](https://cran.r-project.org/) and check whether a more recent version is available. If so, please download and install it. You can check [here](https://cran.r-project.org/bin/windows/base/rw-FAQ.html#How-do-I-UNinstall-R_003f) for more information on how to remove old versions from your system if you wish to do so.

#### macOS

If you don't have R installed on your computer:

- Download R from the [CRAN website](https://cran.r-project.org/bin/macosx/).
- Select the `.pkg` file for the latest R version.
- Double click on the downloaded file to install R
- It is also a good idea to install [XQuartz] (https://www.xquartz.org/) (needed by some packages)
- Once it’s installed, open R to make sure it works and you don’t get any error messages.

If you already have R already install:

To check the version of R you are using, start R: the version of R you are running is the first thing that appears on the terminal. Alternatively, Type `sessionInfo()` in the R console, which will  display which version of R you are running. Go on the [CRAN website](https://cran.r-project.org/bin/macosx/) and check whether a more recent version is available. If so, please download and install it. 


#### Linux

- Follow the instructions for your distribution from [CRAN](https://cloud.r-project.org/bin/linux/), they provide information to get the most recent version of R for common distributions. 

- Once it’s installed, open R to make sure it works and you don’t get any error messages.


### Update

If you already have R on your computer, an alternative is to just run (<span style="color: red">it will tell you if your R version is out-of-date </span>): 

```{r,  eval=FALSE, tidy=TRUE}
if(!require(installr)) {
  install.packages("installr"); require(installr)} 
updateR()
```

This will start the updating process of your R installation.  It will check for newer versions, and if one is available, will guide you through the decisions you need to make. 

You may have to choose a CRAN mirror if it is your first download. This is just a copy of the CRAN archives. Choose one in Taiwan, it is usually a bit faster to download and install. 

### Package

To expand the abilities of R, you can first install a package with its name. The package `ABC` provides tools for Approximate Bayesian Computation (ABC) 

- Install the package `abc`

```{r,  eval=FALSE}
install.packages("abc")
```

```{r,  eval=FALSE}
# all information after `#` is ignored, this is VERY important and use to comment your code.
```

```{r,  eval=FALSE}
install.packages("abc") # I am installing the package 'abc'
```

- Use the package `abc`

```{r,  eval=FALSE}
library("abc")
```

To do every time you wanna use the package: load your package 


> *<span style="color: green">**R_P_1**: Install and load the package </span>* <span style="color: blue">```vegan```</span>

```{r class.source = "fold-hide",  eval=FALSE}
install.packages('vegan')
library('vegan')
```

If you don't know the name of the package:

- Use task views available at http://cran.r-project.org/web/views that group packages to subject areas such environmetrics, multivariate, etc.

### Help

```{r,  eval=FALSE}
?median
# or
help(median)
```

Help on the function <span style="color: blue">```median```</span>

```{r,  eval=FALSE}
?median
```

It will give you details on how to use the function <span style="color: blue">```median```</span>

```{r,  eval=FALSE}
??median
```
It will give you all functions with median in their description 
\WD

Use of working directory

```{r,  eval=FALSE}
getwd()
#Get Working Directory
```

Get the location of your current working directory

```{r,  eval=FALSE}
setwd()
#Set Working Directory
```

Set up a new working directory

\QUITR

### Quit R

```{r,  eval=FALSE}
q()
```
It will leave your R session, do not save your workspace 

\OBJECTS

### List objects

```{r,  eval=FALSE}
ls()
# list
```

It will list all objects in memory

```{r,  eval=FALSE}
rm(list=ls())
# remove list
```

It will remove all objects in memory

**Tip**: Use CTRL+L to clean your screen

\RCALCULATOR

## R is a calculator

```{r,  eval=FALSE}
3+2 # addition
3-2 # substraction
3*2 # multiplication
3/2 # division
3^3 # power
log(2) # logarithm
exp(2) # exponential
(5 + 3) / 4 # define priority using () or {} 
pi*4 # common function
```

R is case sensitive <span style="color: blue">```pi```</span> will work, whereas <span style="color: blue">```Pi```</span> will not </span> 

\EDITOR

### Text editor, Rite
Install and load package <span style="color: blue">```rite```</span> 

```{r,  eval=FALSE}
install.packages('rite')
library('rite')
rite()
riteout() # CTRL+Enter to send your lines
```

This is simple text editor

\READINGDATA

## Reading data
Using <span style="color: blue">```riteout```</span>

```{r,  eval=FALSE, tidy.opts=list(width.cutoff=60),tidy=TRUE}
riteout() # CTRL+Enter to send your lines
setwd ('D:/.../Class 1')# set your working directory
read.table ("taiwan_coral.txt",header = TRUE,sep="\t",dec=".")# opening a simple datasheet
```

<span style="color: #e1d9d7"> You can also target directly your file without setting up your working directory </span>

```{r,  eval=FALSE,  tidy=TRUE}
read.table ("D:/.../Class 1/taiwan.txt",header = TRUE,sep="\t", dec=".")# long version
read.table("taiwan.txt", TRUE, "\t",".")# you can also shorten some part once you get use to it, but be careful when using this
```

<span style="color: #e1d9d7"> Now you can store it in R using the operator</span> <span style="color: #a2c6e5">```<-```</span><span style="color: #e1d9d7">or</span> <span style="color: #a2c6e5">```=```</span>

```{r,  eval=FALSE}
taiwan <- read.table ("taiwan.txt", 	header = TRUE, sep="\t", dec=".")
```
<span style="color: #a2c6e5">```read.delim```</span>
<span style="color: #e1d9d7">or</span>
<span style="color: #a2c6e5">```read.csv```</span> 
<span style="color: #e1d9d7"> and many others are alternative to</span>
<span style="color: #a2c6e5">```read.table```</span>  

<span style="color: #e1d9d7">Now, you can call your data by calling your object</span>
<span style="color: #a2c6e5">```taiwan```</span> 

```{r,  eval=FALSE}
taiwan
```
<span style="color: #e1d9d7">CONGRATS, this is your first script in R</span>


####__*<span style="color: green">Exercice 1b:</span>*__ <span style="color: green">using the script editor of R Studio ("File>New File>R Script""):</span>

#### *<span style="color: green">- change your working directory to the one you created for this class</span>*

#### *<span style="color: green">- import the file <span style="color: #a2c6e5">```rairuoho.txt```</span> (see below) in an object called rairuoho </span>*

*<span style="color: green">extra: try importing the url of the file using:<span style="color:#a2c6e5">```read.table()```</span>*

#### *<span style="color: green">- using the help facilities, find out, how you could read just the first lines, if needed (using the <span style="color: #a2c6e5">```read.table()```</span> function) </span>*

#### *<span style="color: green">- <span style="color: #a2c6e5">```sum()```</span>for this table, values from the 2nd column <span style="color: #a2c6e5">```rairuoho```</span><span style="color: #a2c6e5">```[```</span> no. line<span style="color: #a2c6e5">```,```</span> no. column<span style="color: #a2c6e5">```]```</span> </span>*


####<span style="color: green"> **Knit** your script ("File>Knit Document") in <span style="color: #a2c6e5">`html`</span> format and upload it below</span>


This is an R Markdown document. Markdown is a simple fromatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see